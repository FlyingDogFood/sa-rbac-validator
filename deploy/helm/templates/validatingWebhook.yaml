apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  name: {{ include "sa-rbac-validator.fullname" . }}
webhooks:
- name: sa-rbac-validator.flyingdogfood.github.com
  timeoutSeconds: {{ .Values.webhook.timeoutSeconds }}
  reinvocationPolicy: {{ .Values.webhook.reinvocationPolicy }}
  failurePolicy: {{ .Values.webhook.failurePolicy }}
  clientConfig:
    caBundle: {{ quote .Values.tls.crt }}
    service:
      namespace: {{ .Release.Namespace }}
      name: {{ include "sa-rbac-validator.fullname" . }}
      path: /validate
      port: 443
  rules:
  - operations: ["CREATE", "UPDATE"]
    apiGroups: {{ .Values.webhook.apiGroups | toYaml | nindent 6 }}
    apiVersions: {{ .Values.webhook.apiVersions | toYaml | nindent 6 }}
    resources: {{ .Values.webhook.resources | toYaml | nindent 6 }}
    scope: {{ quote .Values.webhook.scope }}